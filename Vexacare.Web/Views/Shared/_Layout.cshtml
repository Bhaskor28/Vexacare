@using Microsoft.AspNetCore.Identity
@using Vexacare.Domain.Entities.PatientEntities
@using Microsoft.EntityFrameworkCore
@inject Vexacare.Infrastructure.Data.ApplicationDbContext DbContext

@inject SignInManager<Patient> SignInManager
@inject UserManager<Patient> UserManager


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VEXACARE - Feel Good Inside Out</title>

    <!-- ==== Favicon ==== -->
    <link rel="icon" type="image/png" href="~/assets/images/favicon.png" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,100..900;1,100..900&display=swap"
          rel="stylesheet" />

    <!-- ==== Plugins CSS Links ==== -->
    <link rel="stylesheet"
          type="text/css"
          href="~/assets/css/bootstrap.min.css" />
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css"
          integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer" />

    <!-- ==== Custom CSS Links ==== -->
    <link rel="stylesheet" type="text/css" href="~/assets/css/somor.css" />
    <link rel="stylesheet" type="text/css" href="~/assets/css/jahirul.css" />
    <link rel="stylesheet" type="text/css" href="~/assets/css/style.css" />
    <link rel="stylesheet" type="text/css" href="~/assets/css/tarek.css" />
</head>
<body>
    <header>
        <!-- Navbar Section Start  -->
        <nav class="navbar" id="site-navbar">
            <div class="container">
                <div class="nav-inner">
                    <!-- Logo -->
                    <a href="/" class="brand navbar_logo" aria-label="Home">
                        <img src="~/assets/images/logo.png" alt="Logo" />
                    </a>

                    <!-- Nav Links -->
                    <ul class="nav-links" id="nav-links">

                        <li><a href="@Url.Action("Index","Home")">Home</a></li>
                        <li><a href="@Url.Action("Index","Shop")">Shop</a></li>

                        <li>
                            <a href="@Url.Action("Index","Microbiota")">Microbiota Analysis</a>
                        </li>
                        <li>
                            <a href="@Url.Action("Index","Consultations")">Consultations & Home Care</a>
                        </li>
                        <li><a href="#">Blog</a></li>
                        <li>
                            <a href="#">Subscription</a>
                        </li>
                    </ul>

                    @* <!-- Right side --> *@
                    @* <div class="nav-actions"> *@
                    @*     <div class="cart" title="Cart" id="cart-icon" aria-hidden="true"> *@
                    @*         <!-- CardSVG placeholder --> *@
                    @*         <svg viewBox="0 0 24 24" *@
                    @*              fill="none" *@
                    @*              stroke="currentColor" *@
                    @*              stroke-width="1.6" *@
                    @*              stroke-linecap="round" *@
                    @*              stroke-linejoin="round" *@
                    @*              aria-hidden="true"> *@
                    @*             <path d="M6 6h15l-1.4 8.4A2 2 0 0 1 17.6 16H8.4a2 2 0 0 1-2-1.6L5 4H3"></path> *@
                    @*             <circle cx="10" cy="20" r="1"></circle> *@
                    @*             <circle cx="18" cy="20" r="1"></circle> *@
                    @*         </svg> *@
                    @*         <div class="cart-badge" id="cart-count">0</div> *@
                    @*     </div> *@

                    @*     <div class="dropdown" id="account-dropdown"> *@
                    @*         <button class="account-btn" *@
                    @*                 id="account-toggle" *@
                    @*                 aria-expanded="false" *@
                    @*                 aria-haspopup="true"> *@
                    @*             <svg viewBox="0 0 24 24" *@
                    @*                  fill="none" *@
                    @*                  stroke="currentColor" *@
                    @*                  stroke-width="1.6" *@
                    @*                  stroke-linecap="round" *@
                    @*                  stroke-linejoin="round" *@
                    @*                  aria-hidden="true"> *@
                    @*                 <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path> *@
                    @*                 <circle cx="12" cy="7" r="4"></circle> *@
                    @*             </svg> *@
                    @*             <span>Account</span> *@
                    @*             <svg style="margin-left: 6px" *@
                    @*                  viewBox="0 0 24 24" *@
                    @*                  width="16" *@
                    @*                  height="16" *@
                    @*                  fill="none" *@
                    @*                  stroke="currentColor" *@
                    @*                  stroke-width="1.6"> *@
                    @*                 <polyline points="6 9 12 15 18 9"></polyline> *@
                    @*             </svg> *@
                    @*         </button> *@

                    @*         <div class="dropdown-menu" *@
                    @*              id="dropdown-menu" *@
                    @*              role="menu" *@
                    @*              aria-hidden="true"> *@
                    @*             <!-- Login Link --> *@

                    @*             <a href="@Url.Action("login","Account")" *@

                    @*                class="dropdown-item" *@
                    @*                tabindex="0" *@
                    @*                role="menuitem" *@
                    @*                id="login-btn"> *@
                    @*                 <svg viewBox="0 0 24 24" *@
                    @*                      fill="none" *@
                    @*                      stroke="currentColor" *@
                    @*                      stroke-width="1.6"> *@
                    @*                     <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path> *@
                    @*                     <circle cx="12" cy="7" r="4"></circle> *@
                    @*                 </svg> *@
                    @*                 <span>Log In</span> *@
                    @*             </a> *@

                    @*             <!-- Signup Link --> *@

                    @*             <a href="@Url.Action("Register","Account")" *@

                    @*                class="dropdown-item" *@
                    @*                tabindex="0" *@
                    @*                role="menuitem" *@
                    @*                id="signup-btn"> *@
                    @*                 <svg viewBox="0 0 24 24" *@
                    @*                      fill="none" *@
                    @*                      stroke="currentColor" *@
                    @*                      stroke-width="1.6"> *@
                    @*                     <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path> *@
                    @*                     <circle cx="12" cy="7" r="4"></circle> *@
                    @*                     <path d="M19 8v6M22 11h-6" /> *@
                    @*                 </svg> *@
                    @*                 <span>Sign Up</span> *@
                    @*             </a> *@
                    @*         </div> *@
                    @*     </div> *@
                    @* </div> *@


                    @* added by sazib *@

                    
                    <!-- Right side -->
                    <div class="nav-actions">
                        <div class="cart" title="Cart" id="cart-icon" aria-hidden="true">
                            <!-- ...cart SVG and badge... -->
                        </div>

                        <div class="dropdown" id="account-dropdown">
                             @if (SignInManager.IsSignedIn(User))
                            {
                                var user = await UserManager.GetUserAsync(User);
                                var isPatient = await UserManager.IsInRoleAsync(user, "Patient");
                                var isDoctor = await UserManager.IsInRoleAsync(user, "Doctor");
                                var isAdmin = await UserManager.IsInRoleAsync(user, "Admin");
                                var basicInfo = await DbContext.BasicInfos
                                .AsNoTracking()
                                .FirstOrDefaultAsync(b => b.PatientId == user.Id);
                                var profilePic = basicInfo?.ProfilePictureUrl ?? Url.Content("~/assets/images/default-user.png");
                                string displayName = user.UserName;

                                if (isPatient)
                                {
                                    var patient = await DbContext.Users.FindAsync(user.Id);
                                    if (patient != null)
                                    {
                                        displayName = $"{patient.FirstName} {patient.LastName}";
                                       
                                        if (basicInfo != null && !string.IsNullOrEmpty(basicInfo.ProfilePictureUrl))
                                        {
                                            profilePic = basicInfo.ProfilePictureUrl;
                                        }
                                    }
                                }
                                <button class="account-btn" id="account-toggle" aria-expanded="false" aria-haspopup="true">
                                    <img src="@profilePic"
                                         alt="Profile"
                                         style="width:32px;height:32px;border-radius:50%;object-fit:cover;margin-right:8px;" />
                                    <span>@displayName</span>
                                    <svg style="margin-left: 6px" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="1.6">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </button>
                                <div class="dropdown-menu" id="dropdown-menu" role="menu" aria-hidden="true">
                                    @if (isPatient)
                                    {
                                        <a href="@Url.Action("BasicInfo", "Account")" class="dropdown-item" tabindex="0" role="menuitem">
                                            <i class="fa fa-user"></i> <span>Profile</span>
                                        </a>
                                    }
                                    @if (isAdmin)
                                    {
                                        <a href="@Url.Action("Index", "Admin")" class="dropdown-item" tabindex="0" role="menuitem">
                                            <i class="fa fa-user"></i> <span>Dashboard</span>
                                        </a>
                                    }
                                    <form asp-area="" asp-controller="Account" asp-action="Logout" method="post" style="margin:0;">
                                        <button type="submit" class="dropdown-item" style="width:100%;text-align:left;">
                                            <i class="fa fa-sign-out-alt"></i> <span>Sign Out</span>
                                        </button>
                                    </form>
                                </div>
                            }
                            else
                            {
                                <button class="account-btn" id="account-toggle" aria-expanded="false" aria-haspopup="true">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="12" cy="7" r="4"></circle>
                                    </svg>
                                    <span>Account</span>
                                    <svg style="margin-left: 6px" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="1.6">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </button>
                                <div class="dropdown-menu" id="dropdown-menu" role="menu" aria-hidden="true">
                                    <a href="@Url.Action("Login", "Account")" class="dropdown-item" tabindex="0" role="menuitem" id="login-btn">
                                        <i class="fa fa-sign-in-alt"></i> <span>Log In</span>
                                    </a>
                                    <a href="@Url.Action("Register", "Account")" class="dropdown-item" tabindex="0" role="menuitem" id="signup-btn">
                                        <i class="fa fa-user-plus"></i> <span>Sign Up</span>
                                    </a>
                                </div>
                            }
                        </div>

                    </div>



                </div>
            </div>
        </nav>
        <!-- Navbar Section End  -->
    </header>
    <div class="container">
        <main id="main" class="pb-3">
            @RenderBody()
        </main>
    </div>

    <!-- Footer Section Start  -->
    <footer id="footer_section" class="footer-bg">
        <div class="container">
            <div class="footer-grid">
                <!-- Logo and Description -->
                <div class="footer-logo-section">
                    <div class="footer-logo-wrapper">
                        <img src="~/assets/images/logo-white.png"
                             alt="Logo"
                             class="footer-logo" />
                    </div>
                    <p class="footer-description">
                        Transforming gut health through science and technology
                    </p>

                    <!-- Social Icons -->
                    <div class="social-icons">
                        <a href="#" class="social-icon" title="Facebook">
                            <i class="fa-brands fa-facebook-f"></i>
                        </a>
                        <a href="#" class="social-icon" title="Instagram">
                            <i class="fa-brands fa-instagram"></i>
                        </a>
                        <a href="#" class="social-icon" title="Twitter">
                            <i class="fa-brands fa-x-twitter"></i>
                        </a>
                        <a href="#" class="social-icon" title="LinkedIn">
                            <i class="fa-brands fa-linkedin-in"></i>
                        </a>
                    </div>
                </div>

                <!-- Footer Sections -->
                <div class="footer-section">
                    <h6>Products & Services</h6>
                    <ul>
                        <li><a href="#">Test Kits</a></li>
                        <li><a href="#">Supplements</a></li>
                        <li><a href="#">Consultations</a></li>
                        <li><a href="#">Corporate Wellness</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h6>Resources</h6>
                    <ul>
                        <li><a href="#">Blog</a></li>
                        <li><a href="#">Partner Hub</a></li>
                        <li><a href="#">Subscription</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h6>Policy</h6>
                    <ul>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">FAQ</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h6>Contact Us</h6>
                    <ul>
                        <li><a href="#">Dhaka, Bangladesh</a></li>
                        <li><a href="#">asfafsafsadf@gmail.com</a></li>
                        <li><a href="#">+880 145 8746 546</a></li>
                    </ul>
                </div>
            </div>

            <hr class="divider" />

            <div class="footer-bottom">
                <span>
                    The contents of this website are &copy;
                    <script>
                        document.write(new Date().getFullYear());
                    </script>
                    Copyright
                </span>
            </div>
        </div>
    </footer>
    <!-- Footer Section End  -->
    <!-- ==== All Js Links ==== -->

     <script src="~/assets/js/jquery-3.7.1.min.js"></script> 

    <script src="~/assets/js/doctos.js"></script>
    <script src="~/assets/js/main.js"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
